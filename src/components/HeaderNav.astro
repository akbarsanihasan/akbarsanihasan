---
import { getCollection } from 'astro:content'
const [{ data }] = await getCollection('personal')
const { email, socials } = data
---

<header>
    <nav>
        <div class="nav-control">
            <a
                href="/"
                class="brand text-xl text-display text-bold effect-shine"
                >Akbar Sani H.</a
            >
            <button id="nav-control-button" data-open="close">Menu</button>
        </div>
        <ul class="nav-links hidden" id="nav-links">
            <li>
                <a href="/about" class="effect-shine">About,</a>
            </li>
            <li>
                <a href="/projects" class="effect-shine">Projects,</a>
            </li>
            <li>
                <a href="/blogs" class="effect-shine">Blogs.</a>
            </li>
        </ul>
    </nav>
    <ul class="socials hidden" id="socials">
        <li>
            <button id="email" data-email={email} class="effect-underline"
                >Email,</button
            >
        </li>
        <li>
            <a href="Resume.pdf" target="_blank" class="effect-underline"
                >Resume,</a
            >
        </li>
        {
            socials.map((social) => (
                <li>
                    <a
                        href={social.url}
                        class="effect-underline"
                        target="_blank"
                    >
                        {social.name}
                    </a>
                </li>
            ))
        }
    </ul>
</header>

<style>
    header {
        padding: 0.8em 0;
    }

    .nav-links.hidden,
    .socials.hidden {
        display: none;
    }

    .nav-control {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    @media screen and (min-width: 1024px) {
        header {
            padding: 0;
        }
        .nav-control > button {
            display: none;
        }
        .nav-links.hidden,
        .socials.hidden {
            display: flex;
        }
    }
</style>

<script>
    const email = document.getElementById('email')
    const navLinks = document.getElementById('nav-links')
    const socials = document.getElementById('socials')
    const navControlBtn = document.getElementById('nav-control-button')

    navControlBtn?.addEventListener('click', function (e) {
        const isOpen = this.dataset.open == 'open'

        navLinks?.classList.toggle('hidden', isOpen)
        socials?.classList.toggle('hidden', isOpen)

        this.setAttribute('data-open', isOpen ? 'close' : 'open')
        this.innerText = this.dataset.open == 'open' ? 'Close' : 'Menu'
    })

    let emailTimeout: NodeJS.Timeout | null = null
    email?.addEventListener('click', function (event) {
        event.preventDefault()
        const email = this.dataset.email as string

        if (!navigator.clipboard) {
            window.location.href = `mailto:${email}`
            return
        }

        navigator.clipboard
            .write([
                new ClipboardItem({
                    ['text/plain']: email,
                }),
            ])
            .then(() => {
                this.innerText = 'Email copied,'

                if (emailTimeout) clearTimeout(emailTimeout)
                emailTimeout = setTimeout(() => {
                    this.innerText = 'Email,'
                }, 3000)
            })
    })
</script>
